<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³å£°å…¥åŠ›ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .audio-display {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        #transcription {
            min-height: 100px;
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ éŸ³å£°å…¥åŠ›ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="status info" id="status">
            ãƒã‚¤ã‚¯ã®æ¨©é™ã‚’ç¢ºèªä¸­...
        </div>
        
        <div>
            <button class="button" id="startBtn">ğŸ¤ éŒ²éŸ³é–‹å§‹</button>
            <button class="button" id="stopBtn" disabled>â¹ï¸ éŒ²éŸ³åœæ­¢</button>
        </div>
        
        <div class="audio-display">
            <h3>éŸ³å£°èªè­˜çµæœ:</h3>
            <div id="transcription">éŸ³å£°ã‚’éŒ²éŸ³ã—ã¦ãã ã•ã„...</div>
        </div>
        
        <div class="audio-display">
            <h3>éŒ²éŸ³ã•ã‚ŒãŸéŸ³å£°:</h3>
            <audio id="audioPlayer" controls></audio>
        </div>
        
        <div class="audio-display">
            <h3>ãƒ‡ãƒãƒƒã‚°æƒ…å ±:</h3>
            <div id="debug"></div>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const transcription = document.getElementById('transcription');
        const audioPlayer = document.getElementById('audioPlayer');
        const debug = document.getElementById('debug');
        
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
        function log(message) {
            console.log(message);
            debug.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        }
        
        // ãƒã‚¤ã‚¯ã®æ¨©é™ç¢ºèª
        async function checkMicrophonePermission() {
            try {
                log('ğŸ¤ ãƒã‚¤ã‚¯ã®æ¨©é™ã‚’ç¢ºèªä¸­...');
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                log('âœ… ãƒã‚¤ã‚¯ã®æ¨©é™ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸ');
                status.className = 'status success';
                status.textContent = 'âœ… ãƒã‚¤ã‚¯ã®æ¨©é™ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸ';
                stream.getTracks().forEach(track => track.stop());
                return true;
            } catch (error) {
                log(`âŒ ãƒã‚¤ã‚¯ã®æ¨©é™ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                status.className = 'status error';
                status.textContent = `âŒ ãƒã‚¤ã‚¯ã®æ¨©é™ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                return false;
            }
        }
        
        // éŒ²éŸ³é–‹å§‹
        async function startRecording() {
            try {
                log('ğŸ¤ éŒ²éŸ³é–‹å§‹...');
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                    log(`ğŸ“¦ éŸ³å£°ãƒ‡ãƒ¼ã‚¿å—ä¿¡: ${event.data.size} bytes`);
                };
                
                mediaRecorder.onstop = () => {
                    log('â¹ï¸ éŒ²éŸ³åœæ­¢');
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayer.src = audioUrl;
                    
                    // éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’Base64ã«å¤‰æ›
                    const reader = new FileReader();
                    reader.onload = () => {
                        const base64Audio = reader.result.split(',')[1];
                        log(`ğŸ”¢ Base64å¤‰æ›å®Œäº†: ${base64Audio.substring(0, 50)}...`);
                        
                        // éŸ³å£°èªè­˜ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã®APIã¯å‘¼ã³å‡ºã•ãªã„ï¼‰
                        simulateSpeechRecognition(base64Audio);
                    };
                    reader.readAsDataURL(audioBlob);
                };
                
                mediaRecorder.start();
                isRecording = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                
                status.className = 'status info';
                status.textContent = 'ğŸ¤ éŒ²éŸ³ä¸­...';
                log('âœ… éŒ²éŸ³é–‹å§‹æˆåŠŸ');
                
            } catch (error) {
                log(`âŒ éŒ²éŸ³é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                status.className = 'status error';
                status.textContent = `âŒ éŒ²éŸ³é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        // éŒ²éŸ³åœæ­¢
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
                
                status.className = 'status info';
                status.textContent = 'â¹ï¸ éŒ²éŸ³åœæ­¢ä¸­...';
                
                // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }
        
        // éŸ³å£°èªè­˜ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateSpeechRecognition(base64Audio) {
            log('ğŸ¤– éŸ³å£°èªè­˜å‡¦ç†ä¸­...');
            
            // å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã®ä»£ã‚ã‚Šã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            setTimeout(() => {
                const mockTranscription = "ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®éŸ³å£°èªè­˜çµæœã§ã™ã€‚å®Ÿéš›ã®APIã§ã¯ã€Fish Audio APIãŒéŸ³å£°ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚";
                transcription.textContent = mockTranscription;
                log(`ğŸ“ éŸ³å£°èªè­˜å®Œäº†: ${mockTranscription}`);
                
                status.className = 'status success';
                status.textContent = 'âœ… éŸ³å£°èªè­˜å®Œäº†';
            }, 2000);
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        startBtn.addEventListener('click', startRecording);
        stopBtn.addEventListener('click', stopRecording);
        
        // åˆæœŸåŒ–
        checkMicrophonePermission();
        
        log('ğŸš€ éŸ³å£°å…¥åŠ›ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
    </script>
</body>
</html>



